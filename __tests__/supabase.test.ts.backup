/**
 * WhatsSound â€” Supabase Connection Tests
 * Tests database connection, seed data, and table integrity
 */

import { supabase } from '../src/lib/supabase';

describe('Supabase Connection', () => {
  test('should connect to Supabase successfully', async () => {
    const { data, error } = await supabase
      .from('ws_profiles')
      .select('id')
      .limit(1);
    
    expect(error).toBeNull();
    expect(data).toBeDefined();
  });

  test('should have seed data in ws_profiles', async () => {
    const { data, error, count } = await supabase
      .from('ws_profiles')
      .select('*', { count: 'exact' })
      .limit(1);
    
    expect(error).toBeNull();
    expect(count).toBeGreaterThanOrEqual(15);
  });

  test('should have all required tables', async () => {
    const tables = [
      'ws_profiles', 
      'ws_sessions', 
      'ws_songs', 
      'ws_messages', 
      'ws_session_members',
      'ws_admin_settings'
    ];
    
    for (const table of tables) {
      const { error } = await supabase
        .from(table)
        .select('*')
        .limit(1);
      
      expect(error).toBeNull();
    }
  });

  test('should have DJs in ws_profiles', async () => {
    const { data, error } = await supabase
      .from('ws_profiles')
      .select('*')
      .eq('is_dj', true)
      .limit(5);
    
    expect(error).toBeNull();
    expect(data).toBeDefined();
    expect(data?.length).toBeGreaterThan(0);
    
    if (data && data.length > 0) {
      expect(data[0]).toHaveProperty('dj_name');
      expect(data[0]).toHaveProperty('genres');
    }
  });

  test('should have active sessions', async () => {
    const { data, error } = await supabase
      .from('ws_sessions')
      .select('*')
      .eq('is_active', true)
      .limit(3);
    
    expect(error).toBeNull();
    expect(data).toBeDefined();
    // Note: May be empty if no active sessions, that's ok
  });
});